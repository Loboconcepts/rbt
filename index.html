<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Robot</title>
	<style type="text/css">
	body {
		background-color: #000000;
	}
	.food {
		width: 10px;
		height: 10px;
		background-color: #773333;
		position: absolute;
		z-index: 100;
		border-radius:30%;
		box-shadow: 0px 1px 1px #777777;
	}
	#pet {
		width:30px;
		height: 30px;
		border-radius:100%;
		background-color: #FF00FF;
		position: absolute;
		z-index: 1000;
		box-shadow: 0px 2px 2px #777777;
	}
	.speak::after {
		position: absolute;
		content: attr(data-txt);
		left:35px;
		opacity: 100;
		font-family: Arial,Helvetica,'sans-serif';
		background-color: #ffffff;
		border-radius:10px;
		padding:3px;
		font-size:11px;
		box-shadow: 0px 2px 2px #777777;
	}

	#window {
		/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#f2f9fe+0,d6f0fd+100;White+3D+%232 */
		background: #f2f9fe; /* Old browsers */
		background: -moz-linear-gradient(top, #f2f9fe 0%, #d6f0fd 100%); /* FF3.6-15 */
		background: -webkit-linear-gradient(top, #f2f9fe 0%,#d6f0fd 100%); /* Chrome10-25,Safari5.1-6 */
		background: linear-gradient(to bottom, #f2f9fe 0%,#d6f0fd 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f2f9fe', endColorstr='#d6f0fd',GradientType=0 ); /* IE6-9 */
		margin:10px;
	}

	</style>
</head>
<body onresize="resizeField()" style="margin: 0px;">

	<div data-txt="hey!" id="pet" style="left: 20px;top: 20px;"></div>

	<div id="window">

		<div id="anchor">
		</div>
	</div>



	<script type="text/javascript">
		var bored = 0;
		var happiness = 0;
		var whatDidIJustDo = "Nothing";
		document.getElementById("window").style.width = (window.innerWidth - 20) + "px";
		document.getElementById("window").style.height = (window.innerHeight - 20) + "px";

		// talk function
		function speak(sayWhat) {
			document.getElementById("pet").dataset.txt = sayWhat;
			document.querySelector('#pet').classList.add("speak");
			function removeWord() {document.querySelector('#pet').classList.remove("speak");}
			setTimeout(removeWord, ((sayWhat.length * 100) + 600));
		}

		// resize the field
		function resizeField() {
			document.getElementById("window").style.width = (window.innerWidth - 20) + "px";
			document.getElementById("window").style.height = (window.innerHeight - 20) + "px";
		}
		function generateCoordinates(ev) {
			var x = event.clientX;
    		var y = event.clientY;
    		dropFood(x, y);
    		clearInterval(thinkNow);
    		thinkNow = window.setInterval(ifFoodExists, 24);
		}

		function ifFoodExists() {
			if (document.querySelector(".food")) {
				bored = 0;
				thinkAboutEating();
			}
			else {
				clearInterval(thinkNow);
				thinkNow = window.setInterval(generalState, 5000);
			}
		}

		function dropFood(xCor, yCor) {
			if (!document.querySelectorAll(".food").item(3)) {
				var newFood = document.createElement("div");
				newFood.setAttribute("class","food");
				newFood.style.left = xCor + "px";
				newFood.style.top = yCor + "px";
				var currentDiv = document.getElementById("anchor");
		  		document.getElementById("window").insertBefore(newFood, currentDiv);
		  		whichFoodIsCloser();
			}
		}
		
		function whichFoodIsCloser() {
			var i = 0;
			while (i < document.querySelectorAll(".food").length ) {
				var topItemLeft = parseInt((document.querySelectorAll(".food").item(i).style.left).replace("px",""),10);
				var newestItemLeft = parseInt((document.querySelectorAll(".food").item(document.querySelectorAll(".food").length - 1).style.left).replace("px",""),10);
				var topItemTop = parseInt((document.querySelectorAll(".food").item(i).style.top).replace("px",""),10);
				var newestItemTop = parseInt((document.querySelectorAll(".food").item(document.querySelectorAll(".food").length - 1).style.top).replace("px",""),10);
				var petPositionLeft = parseInt((document.querySelector("#pet").style.left).replace("px",""),10);
				var petPositionTop = parseInt((document.querySelector("#pet").style.top).replace("px",""),10);
				if ((Math.abs(petPositionLeft - newestItemLeft)) + (Math.abs(petPositionTop - newestItemTop)) < (Math.abs(petPositionLeft - topItemLeft)) + (Math.abs(petPositionTop - topItemTop))) {
					document.getElementById("window").insertBefore(document.querySelectorAll(".food").item(document.querySelectorAll(".food").length - 1), document.querySelectorAll(".food").item(i));
					break;
				}
				else {
					i ++
				}		
			}		
		}
		
		function thinkAboutEating() {
			var foodPositionLeft = parseInt((document.querySelector(".food").style.left).replace("px",""),10);
			var foodPositionTop = parseInt((document.querySelector(".food").style.top).replace("px",""),10);
			var petPositionLeft = parseInt((document.querySelector("#pet").style.left).replace("px",""),10);
			var petPositionTop = parseInt((document.querySelector("#pet").style.top).replace("px",""),10);
			var distanceToFoodLeft = foodPositionLeft - petPositionLeft;
			var distanceToFoodTop = foodPositionTop - petPositionTop;
			if ((distanceToFoodLeft <= 30 && distanceToFoodLeft > -6) && (distanceToFoodTop <= 30 && distanceToFoodTop > -6))  {
				document.querySelector(".food").remove();
				speak("yum!");
				whatDidIJustDo = "Eat";
			}
			else {
				if (petPositionLeft < foodPositionLeft) {
					petPositionLeft = petPositionLeft + 1;
					document.querySelector("#pet").style.left = petPositionLeft + "px";
				}
				if (petPositionTop < foodPositionTop) {
					petPositionTop = petPositionTop + 1;
					document.querySelector("#pet").style.top = petPositionTop + "px";
				}
				if (petPositionLeft > foodPositionLeft) {
					petPositionLeft = petPositionLeft - 1;
					document.querySelector("#pet").style.left = petPositionLeft + "px";
				}
				if (petPositionTop > foodPositionTop) {
					petPositionTop = petPositionTop - 1;
					document.querySelector("#pet").style.top = petPositionTop + "px";
				}
			}
		}
		var dir = Math.floor(Math.random()*4);

		function generalState() {
			bored = bored + 10
			if (bored == 20) {
				var rand = Math.floor(Math.random()*2);
				if(rand == 1) {
					speak("RAWR");
					whatDidIJustDo = "Rawr";
				}
			}
			if (bored >= 40) {
				dir = Math.floor(Math.random()*4);
				thinkNow = window.setInterval(moveAroundRandomlyOutOfBoredom, 24);
			}
			console.log("The last thing I did was: " + whatDidIJustDo);
		}

		function petted() {
			speak("prrrrrrr");	
			happiness = happiness + 1;
			bored = 0
		}

		function moveAroundRandomlyOutOfBoredom () {
			var petPositionLeft = parseInt((document.querySelector("#pet").style.left).replace("px",""),10);
			var petPositionTop = parseInt((document.querySelector("#pet").style.top).replace("px",""),10);
			if (bored >= 11) {
				if (dir == 0) {
					if (petPositionTop > 30) {mvUp();}
					else {dir = 2;}
				}
				if (dir == 1) {
					if (petPositionLeft < window.innerWidth - 30) {mvRight();}
					else {dir = 3;}
				}
				if (dir == 2) {
					if (petPositionTop < window.innerHeight - 30) {mvDown();}
					else {dir = 0;}			
				}
				if (dir == 3) {
					if (petPositionLeft > 30) {mvLeft();}
					else {dir = 1;}
				}
				bored = bored - 1;
			}
			else {
				clearInterval(thinkNow);
			}
		}

		// directional
		function mvUp() {
			var petPositionTop = parseInt((document.querySelector("#pet").style.top).replace("px",""),10);
			if (petPositionTop > 30) {
				petPositionTop = petPositionTop - 1;
				document.querySelector("#pet").style.top = petPositionTop + "px";
				whatDidIJustDo = "Move up";
			}
		}
		function mvRight() {
			var petPositionLeft = parseInt((document.querySelector("#pet").style.left).replace("px",""),10);
			if (petPositionLeft < window.innerWidth - 30) {
				petPositionLeft = petPositionLeft + 1;
				document.querySelector("#pet").style.left = petPositionLeft + "px";
				whatDidIJustDo = "Move right";
			}
		}
		function mvDown() {
			var petPositionTop = parseInt((document.querySelector("#pet").style.top).replace("px",""),10);
			if (petPositionTop < window.innerHeight - 30) {
				petPositionTop = petPositionTop + 1;
				document.querySelector("#pet").style.top = petPositionTop + "px";
				whatDidIJustDo = "Move down";
			}
		}
		function mvLeft() {
			var petPositionLeft = parseInt((document.querySelector("#pet").style.left).replace("px",""),10);
			if (petPositionLeft > 30) {
				petPositionLeft = petPositionLeft - 1;
				document.querySelector("#pet").style.left = petPositionLeft + "px";
				whatDidIJustDo = "Move left";
			}
		}

		document.getElementById("window").onclick = generateCoordinates;
		document.getElementById("pet").onclick = petted;

		// Thinking twice a second
		var thinkNow = window.setInterval(generalState, 5000);

		
	</script>

</body>
</html>
